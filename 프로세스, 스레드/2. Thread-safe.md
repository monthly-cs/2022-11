# **프로세스와 스레드의 차이**

이 문서는 2022년 11월 20일에 @kwanyung에 의해서 작성되었습니다.

```
1. Thread-safe
    - 멀티 스레드
    - 멀티 스레드의 문제점?
    - Thread-safe
2. PCB
    - 프로세스 관리
    - PCB
    - PCB의 관리 방식
3. Context Switching
    - 정의
    - 수행 과정
    - 비용
```

# 1. **Thread-safe**

## 1-1. **멀티 스레드**

- Node.js를 접하면 가장 많이 듣는 용어인 `단일 스레드`
  - 때문에 JS를 사용하는 개발자에게는 와닿지 않는 용어

## 멀티스레드?

- 여러 클라이언트에서 오는 요청을 동시에 여러개의 스레드로 처리.
- 대표적으로 JAVA는 멀티스레드 처리 방식을 지원함.
  (싱글 vs 멀티)

## 1-2 **멀티 스레드의 문제점?**

최초 value의 값은 0

```
value++
```

(스레드 안정성)

value++

- 위 작업은 단일 작업으로 보이지만 사실 3개의 작업이 동작!
  > 1. 메모리에서 value값을 CPU 레지스터로 가져옴
  > 2. value의 값을 1 증가시킴
  > 3. 1 증가된 value 값을 다시 메모리로 되돌려줌.

두 개의 스레드가 위의 작업을 수행하는 경우

- A스레드에서 value = 0을 읽어 값을 로드
- B스레드에서 value = 0을 읽어 값을 로드
- A스레드에서 value ++ 을 수행해 값을 1 증가시킴
- B스레드에서 value ++ 을 수행해 값을 1 증가시킴
- 두 스레드 모두 1이라는 값을 반환시킴
- 당연히 2라는 값이 반환되어야 하지 않을까?

스레드는 기본적으로 코드를 공유하기 때문에 전역변수 등을 공유하게 됨.
<br> => 많은 스레드에서 동시에 접근

## 1-3 **Thread-safe**

- 여러 스레드에서 클래스 혹은 클래스의 객체에 동시에 접근해서 사용하더라도 정확하게 동작함

1-2와 같은경우는 `스레드 안전하지 않다` 라고 볼 수 있는 것!

`스레드 안전한 상태`를 위해서는 다음 세가지 방법으로 처리해야함.

1. 공유되는 상태 변수를 스레드 간 공유되지 않도록 바꾸기
2. 공유되는 상태 변수를 변경할 수 없게 만들기
3. 공유되는 상태 변수를 사용할 때 항상 동기화

JAVA에서는 synchronized 키워드를 메서드 앞에 붙여 하나의 스레드만 instance 변수를 보고 판단해 객체를 생성하고록 강제할 수 있음.

동기화 (Synchronized)란?

- 하나 이상의 Thread가 어떤 로직에 동시에 접근했을 때, 그 연산에 대한 값의 무결성을 보장하기 위해 수행 영역에 대한 lock을 걸어주는 것.

---

# 2. **PCB**

## 2-1 **프로세스 관리**

- 구동중인 프로세스가 여러 개일 때, CPU 스케줄링을 이용해 프로세스를 관리하는 것.
  - CPU는 각 프로세스가 고유하게 가지는 `Process Metadata`를 활용해 프로세스를 구분.

프로세스 메타데이터가 담고있는 정보

- 프로세스 고유 ID (PID)
- 프로세스 상태
- 프로세스 우선순위
- Program Counter (PC)
- CPU 레지스터
- Owner
- Memory Limit
- 기타 등등

## 메타데이터는 프로세스가 생성될 때 `PCB`에 저장!

---

## 2-2 **PCB**

(PCB)

- 한 PCB안에는 한 프로세스의 정보가 담김.
